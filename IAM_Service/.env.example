# =============================================================================
# IAM SERVICE - ENVIRONMENT VARIABLES
# =============================================================================
# Copy this file to .env and update the values for your environment
# DO NOT commit the .env file with real secrets!
# =============================================================================

# -----------------------------------------------------------------------------
# Application Configuration
# -----------------------------------------------------------------------------
SPRING_PROFILES_ACTIVE=dev
SERVER_PORT=8081

# -----------------------------------------------------------------------------
# Database Configuration (PostgreSQL)
# -----------------------------------------------------------------------------
# Primary database for IAM business logic
SPRING_DATASOURCE_URL=jdbc:postgresql://iam-db:5432/iam_logic_db
SPRING_DATASOURCE_USERNAME=user_admin
SPRING_DATASOURCE_PASSWORD=password_secure

# Database for Keycloak (separate schema)
KC_DB=postgres
KC_DB_URL=jdbc:postgresql://iam-db:5432/keycloak_db
KC_DB_USERNAME=user_admin
KC_DB_PASSWORD=password_secure

# PostgreSQL container configuration
POSTGRES_USER=user_admin
POSTGRES_PASSWORD=password_secure
POSTGRES_MULTIPLE_DATABASES=keycloak_db,iam_logic_db

# -----------------------------------------------------------------------------
# Keycloak Configuration
# -----------------------------------------------------------------------------
# Keycloak server URL (internal Docker network)
KEYCLOAK_SERVER_URL=http://iam-keycloak:8080

# Admin credentials for Keycloak
KC_BOOTSTRAP_ADMIN_USERNAME=admin
KC_BOOTSTRAP_ADMIN_PASSWORD=admin_password

# Keycloak realm configuration
KEYCLOAK_REALM=ExamsRealm

# OAuth2 Client configuration for backend service
KEYCLOAK_CLIENT_ID=iam-admin-client
KEYCLOAK_CLIENT_SECRET=k2jrL3KQ0lNNY3VF8sZxLQ3azw0FUi36

# JWT configuration for resource server
# IMPORTANT: Use localhost for browser-based clients
SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_ISSUER_URI=http://localhost:8080/realms/ExamsRealm
# Use internal Docker hostname for backend validation
SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_JWK_SET_URI=http://iam-keycloak:8080/realms/ExamsRealm/protocol/openid-connect/certs

# Keycloak hostname configuration
KC_HOSTNAME=localhost
KC_HOSTNAME_URL=http://localhost:8080
KC_HTTP_ENABLED=true
KC_HOSTNAME_STRICT=false
KC_HOSTNAME_DEBUG=true
KC_HEALTH_ENABLED=true

# Realm import configuration
KC_IMPORT=/opt/keycloak/data/import/realm-export.json

# -----------------------------------------------------------------------------
# RabbitMQ Configuration
# -----------------------------------------------------------------------------
SPRING_RABBITMQ_HOST=rabbitmq
SPRING_RABBITMQ_PORT=5672
SPRING_RABBITMQ_USERNAME=guest
SPRING_RABBITMQ_PASSWORD=guest

# RabbitMQ Management UI
RABBITMQ_MANAGEMENT_PORT=15672

# -----------------------------------------------------------------------------
# Email Configuration (SMTP - Gmail)
# -----------------------------------------------------------------------------
# These should be configured in Keycloak UI or realm-export.json
# Generate app password: https://myaccount.google.com/apppasswords

# SMTP_FROM=your-email@gmail.com
# SMTP_HOST=smtp.gmail.com
# SMTP_PORT=587
# SMTP_AUTH=true
# SMTP_USERNAME=your-email@gmail.com
# SMTP_PASSWORD=your-16-char-app-password
# SMTP_STARTTLS=true

# -----------------------------------------------------------------------------
# Logging Configuration
# -----------------------------------------------------------------------------
LOGGING_LEVEL_ROOT=INFO
LOGGING_LEVEL_COM_EXAMPLE_IAM=DEBUG
LOGGING_LEVEL_ORG_SPRINGFRAMEWORK_SECURITY=DEBUG
LOGGING_LEVEL_ORG_KEYCLOAK=INFO

# -----------------------------------------------------------------------------
# JVM Configuration
# -----------------------------------------------------------------------------
# Using ZGC (Generational) for Java 21
JAVA_OPTS=-XX:+UseZGC -XX:+ZGenerational -Xms512m -Xmx1024m

# -----------------------------------------------------------------------------
# Docker Configuration
# -----------------------------------------------------------------------------
# Exposed ports
IAM_SERVICE_PORT=8081
KEYCLOAK_PORT=8080
POSTGRES_PORT=5433
RABBITMQ_AMQP_PORT=5672
RABBITMQ_MGMT_PORT=15672

# Health check configuration
POSTGRES_HEALTHCHECK_INTERVAL=10s
POSTGRES_HEALTHCHECK_TIMEOUT=5s
POSTGRES_HEALTHCHECK_RETRIES=10
POSTGRES_HEALTHCHECK_START_PERIOD=20s

KEYCLOAK_HEALTHCHECK_INTERVAL=10s
KEYCLOAK_HEALTHCHECK_TIMEOUT=60s
KEYCLOAK_HEALTHCHECK_RETRIES=15
KEYCLOAK_HEALTHCHECK_START_PERIOD=90s

# -----------------------------------------------------------------------------
# Security Configuration (Production)
# -----------------------------------------------------------------------------
# ⚠️ IMPORTANT: Update these for production!
# Never use default passwords in production

# PROD_DB_PASSWORD=<generate-strong-password>
# PROD_KEYCLOAK_ADMIN_PASSWORD=<generate-strong-password>
# PROD_KEYCLOAK_CLIENT_SECRET=<generate-strong-secret>
# PROD_JWT_SECRET=<generate-strong-secret>

# -----------------------------------------------------------------------------
# Monitoring & Observability (Future)
# -----------------------------------------------------------------------------
# SPRING_BOOT_ADMIN_URL=http://admin-server:8080
# MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE=health,info,metrics,prometheus
# MANAGEMENT_METRICS_EXPORT_PROMETHEUS_ENABLED=true

# -----------------------------------------------------------------------------
# Feature Flags (Future)
# -----------------------------------------------------------------------------
# FEATURE_EMAIL_VERIFICATION_ENABLED=true
# FEATURE_TWO_FACTOR_AUTH_ENABLED=false
# FEATURE_SOCIAL_LOGIN_ENABLED=false

# =============================================================================
# Notes:
# 
# 1. Local Development:
#    - Copy this file to .env
#    - Use default values for quick setup
#    - Update SMTP configuration for email testing
#
# 2. Production:
#    - NEVER use default passwords
#    - Use secrets management (Vault, AWS Secrets Manager, etc.)
#    - Enable TLS/SSL
#    - Use environment-specific configurations
#    - Restrict network access
#
# 3. CI/CD:
#    - Use environment variables injection
#    - Never commit secrets to Git
#    - Use separate configs for test/staging/prod
#
# 4. Security Best Practices:
#    - Rotate credentials regularly
#    - Use strong, unique passwords (min 16 characters)
#    - Enable audit logging in production
#    - Monitor for suspicious activities
# =============================================================================
